// kino5.cpp : Defines the entry point for the application.
//

#include "kino5.h"
#include <stdlib.h>
#include <stdio.h>
#include <fstream>
#include <sstream>
#include <vector>
#include <string>
#include <iostream>
#include <iomanip>
#include <windows.h>
#include <cctype>
#include <string>


using namespace std;

void filmy()
{
    system("cls");
    FILE* f;

    int choice;
    do {
        system("cls");
        cout << "1. John Wick 5 [20:30] Sala1\n"
            << "2. Five Nighs at Freddys [15:30] Sala2\n"
            << "3. Napoleon [17:30] Sala3\n"
            << "4. Spatky\n";

        cout << "\nVyber: ";
        cin >> choice;

        switch (choice) {
        case 1: {
            system("cls");

            char buffer[256];
            char pismeno;
            int cislo;
            int ovladaniePismena = 0;
            int ovladanieCisla = 0;

            fopen_s(&f, "C:\\Users\\lovis\\Documents\\Skola\\BPC-PC1T\\Projekt_kino_main\\kino5\\Sala1.txt", "r");

            if (f == nullptr) {
                perror("Chyba pri otvarani suboru.");
                return;
            }

            while (fgets(buffer, sizeof(buffer), f) != nullptr) {
                printf("%s", buffer);
            }
            fclose(f);

            while (getchar() != '\n');

            while (true) {
                system("cls");

                fopen_s(&f, "C:\\Users\\lovis\\Documents\\Skola\\BPC-PC1T\\Projekt_kino_main\\kino5\\Sala1.txt", "r");

                if (f == nullptr) {
                    perror("Chyba pri otvarani suboru.");
                    return;
                }

                while (fgets(buffer, sizeof(buffer), f) != nullptr) {
                    printf("%s", buffer);
                }
                fclose(f);

                printf("\n\n\nVlozte pismeno a cislo miesta v tvar 'A1': ");

                if (scanf(" %c%d", &pismeno, &cislo) == 2 && isalpha(pismeno) && (cislo > 0 && cislo < 8)) {
                    printf("Napisal si: %c%d\n", pismeno, cislo);
                    ovladanieCisla = 1;
                    Sleep(1000);
                    //break;
                }
                else 
                {
                    system("cls");
                    printf("Zly input! Skuste to znovu.\n");
                    Sleep(1000);

                    while (getchar() != '\n');
                }

                fopen_s(&f, "C:\\Users\\lovis\\Documents\\Skola\\BPC-PC1T\\Projekt_kino_main\\kino5\\Sala1.txt", "r+");

                const int rows = 8;
                const int cols = 24;
                int cisloPismeno = 0;
                int cisloKod = 0;

                // Precitaj a vypíš
                char grid[rows][cols];
                for (int i = 0; i < rows; ++i) {
                    for (int j = 0; j < cols; ++j) {
                        if (fread(&grid[i][j], sizeof(char), 1, f) != 1) {
                            cerr << "Error reading from file." << endl;
                            fclose(f);
                            return;
                        }
                        //cout << grid[i][j] << ' ';    
                    }
                    cout << endl;
                    system("cls");
                }

                //grid[5][5] = 'X';
                // 7 - 23 -- 1-7
                
                switch (pismeno)
                {
                    case 'a':
                    case 'A':
                        cisloPismeno = 7;
                        ovladaniePismena = 1;
                        cisloKod = 1;
                        break;
                    case 'b':
                    case 'B':
                        cisloPismeno = 9;
                        ovladaniePismena = 1;
                        cisloKod = 2;
                        break;
                    case 'c':
                    case 'C':
                        cisloPismeno = 11;
                        ovladaniePismena = 1;
                        cisloKod = 3;
                        break;
                    case 'd':
                    case 'D':
                        cisloPismeno = 13;
                        ovladaniePismena = 1;
                        cisloKod = 4;
                        break;
                    case 'e':
                    case 'E':
                        cisloPismeno = 15;
                        ovladaniePismena = 1;
                        cisloKod = 5;
                        break;
                    case 'f':
                    case 'F':
                        cisloPismeno = 17;
                        ovladaniePismena = 1;
                        cisloKod = 6;
                        break;;
                    case 'g':
                    case 'G':
                        cisloPismeno = 19;
                        ovladaniePismena = 1;
                        cisloKod = 7;
                        break;
                    case 'h':
                    case 'H':
                        cisloPismeno = 21;
                        ovladaniePismena = 1;
                        cisloKod = 8;
                        break;
                    case 'i':
                    case 'I':
                        cisloPismeno = 23;
                        ovladaniePismena = 1;
                        cisloKod = 9;
                        break;

                default:
                    printf_s("Zly input miesta!");
                    Sleep(1000);
                    system("cls");
                    break;
                }

                if ((ovladaniePismena == 1) && (ovladanieCisla == 1))
                {

                    if (grid[cislo][cisloPismeno - 3] == 'X' )
                    {
                        printf_s("Miesto je obsadene.");
                        Sleep(1000);
                    }
                    else
                    {
                        grid[cislo][cisloPismeno - 3] = 'X';

                        printf_s("Tvoj kod je %d%d%d",1, cislo, cisloKod);
                        Sleep(4000);
                        while (getchar() != '\n');

                        rewind(f);

                        // Zmeň a zapíš späť do textaku
                        for (int i = 0; i < rows; ++i) {
                            for (int j = 0; j < cols; ++j) {
                                if (fwrite(&grid[i][j], sizeof(char), 1, f) != 1) {
                                    cerr << "Error writing to file." << endl;
                                    fclose(f);
                                    return;
                                }
                            }
                        }

                        fclose(f);

                        system("cls");
                        printf("\nHotovo");
                    }              
                }
                else
                {
                    system("cls");
                    printf("Zly input2");
                }
               
                Sleep(1000);
                fclose(f);

                //Sleep(2000);

                break;
            }
        }
        case 2:
            system("cls");

            break;
        case 3:

            break;

        case 4:
            system("cls");
            return;
            break;
        default:
            system("cls");
    
        }
    } while (choice != 0);   
}


void zrusitRezervaciu()
{
    FILE* f;

    int cislo = 0;
    int choice;
    const int rows = 8;
    const int cols = 24;
    int cisloPismeno = 0;

    do
    {
        int cisloNaPracu = 0;
        int poslednaCislica = 0;

        system("cls");

        cout << "1. Zrusit rezervaciu na: John Wick 5 [20:30] Sala1\n"
            << "2. Zrusit rezervaciu na: Five Nighs at Freddys [15:30] Sala2\n"
            << "3. Zrusit rezervaciu na: Napoleon [17:30] Sala3 \n"
            << "0. Exit\n";
        cout << "Vyber: ";
        cin >> choice;

        switch (choice)
        {
        case 1:
           
            do
            {
                fflush(stdin);
                system("cls");
                printf_s("Zadajte kod listku: ");

                if ((scanf_s("%d", &cislo)) == 1 && (cislo > 0 && cislo < 180))
                {
                    fopen_s(&f, "C:\\Users\\lovis\\Documents\\Skola\\BPC-PC1T\\Projekt_kino_main\\kino5\\Sala1.txt", "r+");


                    char grid[rows][cols];
                    for (int i = 0; i < rows; ++i) {
                        for (int j = 0; j < cols; ++j) {
                            if (fread(&grid[i][j], sizeof(char), 1, f) != 1) {
                                cerr << "Error reading from file." << endl;
                                fclose(f);
                                return;
                            }    
                        }
                        cout << endl;
                        system("cls");
                    }
                    cisloNaPracu = cislo - 100;
                    poslednaCislica = cisloNaPracu % 10;

                    switch (poslednaCislica)
                    {
                    case 1:
                        cisloPismeno = 7;
                        break;
                    case 2:
                        cisloPismeno = 9;
                        break;
                    case 3:
                        cisloPismeno = 11;
                        break;
                    case 4:
                        cisloPismeno = 13;
                        break;
                    case 5:
                        cisloPismeno = 15;
                        break;
                    case 6:
                        cisloPismeno = 17;
                        break;
                    case 7:
                        cisloPismeno = 19;
                        break;
                    case 8:
                        cisloPismeno = 21;
                        break;
                    case 9:
                        cisloPismeno = 23;
                        break;
                    default:
                        break;
                    }
                   /* if (grid[cislo][cisloPismeno - 3] == 'X')   //Tu som skoncil
                    {
                        printf_s("Miesto je obsadene.");
                        Sleep(1000);
                    }*/

                    printf("AAAAANNNNNOOOOO.");
                    Sleep(2000);

                    fclose(f);
                    return;
                    break;
                                                         
                }
                printf("\nZly kod.");
                Sleep(1000);

                system("cls");
            
                cout << "1. Pokracovat\n"
                    << "2. Exit\n";
                    
                cout << "\nVyber: ";

                cin >> choice;
                switch (choice)
                {
                case 1:

                    break;;
                default:
                    return;
                    break;
                }
                              
            } while (true);
            
           




            
            break;
        case 2:

            break;
        case 3:

            break;
        case 0:
            return;
        default:
            printf("Zla volba.");
            Sleep(1000);
            break;
        }
    } while (choice != 0);
}


int main()
{
    int choice;
    do {
        system("cls");
        cout << "1. Vybrat film a rezervovat miesta\n"
            << "2. Zrusit rezervaciu\n"
            << "3. Zmenit nazov filmu a cas vysielania\n"
            << "0. Exit\n";
        cout << "Vyber: ";
        cin >> choice;

        switch (choice) {
        case 1: 
            system("cls");
            filmy();
            break;      
        case 2:
            system("cls");
            zrusitRezervaciu();
            break;
        case 3:
            system("cls");

            break;
        case 0:
            system("cls");
            cout << "Koniec.\n";
            break;
        default:
            system("cls");
        }
    } while (choice != 0);
}
